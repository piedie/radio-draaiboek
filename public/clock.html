<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Radio Klok - Fullscreen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {}
        }
      }
    </script>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #111;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      }
    </style>
  </head>
  <body class="bg-black text-white flex items-center justify-center min-h-screen">
    <div id="clock-container" class="text-center">
      <div class="text-6xl font-mono font-bold mb-8" id="time-display">
        00:00:00 / 01:00:00
      </div>
      <div class="text-2xl mb-8" id="total-display">
        Totaal: 00:00:00
      </div>
      <svg id="clock-svg" width="600" height="600" class="mx-auto mb-8">
        <!-- Clock will be drawn here -->
      </svg>
      <div class="text-xl" id="status-display">
        ⏸️ Gestopt
      </div>
    </div>

    <script>
      let clockData = {
        items: [],
        currentTime: 0,
        isPlaying: false,
        totalDuration: 0
      };

      // Listen for messages from parent window
      window.addEventListener('message', (event) => {
        if (event.data.type === 'CLOCK_UPDATE') {
          clockData = event.data.data;
          updateClock();
        }
      });

      function formatTime(seconds) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;
        return h + ':' + (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;
      }

      function updateClock() {
        // Update time display
        document.getElementById('time-display').textContent = 
          `${formatTime(clockData.currentTime)} / ${formatTime(3600)}`;
        
        // Update total display
        const totalText = `Totaal: ${formatTime(clockData.totalDuration)}`;
        if (clockData.totalDuration > 3600) {
          document.getElementById('total-display').innerHTML = 
            totalText + `<span style="color: #ef4444; margin-left: 1rem;">(+${formatTime(clockData.totalDuration - 3600)} over)</span>`;
        } else {
          document.getElementById('total-display').textContent = totalText;
        }

        // Update status
        document.getElementById('status-display').textContent = 
          clockData.isPlaying ? '▶️ Afspelen' : '⏸️ Gestopt';

        // Draw clock
        drawClock();
      }

      function drawClock() {
        const svg = document.getElementById('clock-svg');
        const radius = 280;
        const center = 300;
        const hourDuration = 3600;
        
        // Clear previous content
        svg.innerHTML = '';

        // Draw segments
        let acc = 0;
        clockData.items.forEach((item) => {
          const start = acc;
          const end = acc + item.duration;
          if (start >= hourDuration) return;
          
          const dur = Math.min(item.duration, hourDuration - start);
          const angle = (dur / hourDuration) * 360;
          const startA = (start / hourDuration) * 360 - 90;
          const startRad = startA * Math.PI / 180;
          const endRad = (startA + angle) * Math.PI / 180;
          
          const x1 = center + radius * Math.cos(startRad);
          const y1 = center + radius * Math.sin(startRad);
          const x2 = center + radius * Math.cos(endRad);
          const y2 = center + radius * Math.sin(endRad);
          
          const largeArc = angle > 180 ? 1 : 0;
          const path = `M ${center} ${center} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`;
          
          const pathElement = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          pathElement.setAttribute('d', path);
          pathElement.setAttribute('fill', end > hourDuration ? '#dc2626' : item.color);
          pathElement.setAttribute('stroke', '#374151');
          pathElement.setAttribute('stroke-width', '2');
          pathElement.setAttribute('opacity', '0.8');
          svg.appendChild(pathElement);
          
          acc += item.duration;
        });

        // Draw time markers
        [0, 15, 30, 45].forEach(min => {
          const a = (min / 60) * 360 - 90;
          const rad = a * Math.PI / 180;
          
          const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          line.setAttribute('x1', center + (radius - 30) * Math.cos(rad));
          line.setAttribute('y1', center + (radius - 30) * Math.sin(rad));
          line.setAttribute('x2', center + radius * Math.cos(rad));
          line.setAttribute('y2', center + radius * Math.sin(rad));
          line.setAttribute('stroke', '#6b7280');
          line.setAttribute('stroke-width', '4');
          svg.appendChild(line);
          
          const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          text.setAttribute('x', center + (radius + 40) * Math.cos(rad));
          text.setAttribute('y', center + (radius + 40) * Math.sin(rad));
          text.setAttribute('text-anchor', 'middle');
          text.setAttribute('dominant-baseline', 'middle');
          text.setAttribute('class', 'text-2xl font-bold fill-white');
          text.textContent = min;
          svg.appendChild(text);
        });

        // Draw hand
        const currAngle = (clockData.currentTime / hourDuration) * 360 - 90;
        const currRad = currAngle * Math.PI / 180;
        const handX = center + (radius - 20) * Math.cos(currRad);
        const handY = center + (radius - 20) * Math.sin(currRad);
        
        const hand = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        hand.setAttribute('x1', center);
        hand.setAttribute('y1', center);
        hand.setAttribute('x2', handX);
        hand.setAttribute('y2', handY);
        hand.setAttribute('stroke', '#fff');
        hand.setAttribute('stroke-width', '6');
        svg.appendChild(hand);
        
        const centerDot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        centerDot.setAttribute('cx', center);
        centerDot.setAttribute('cy', center);
        centerDot.setAttribute('r', '12');
        centerDot.setAttribute('fill', '#fff');
        svg.appendChild(centerDot);
      }

      // Initial empty state
      updateClock();

      // Request data from parent window if it exists
      if (window.opener) {
        window.opener.postMessage({ type: 'CLOCK_WINDOW_READY' }, '*');
      }
    </script>
  </body>
</html>
